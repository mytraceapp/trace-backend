Goal:
When the last user message is clearly about food / cooking / recipes, TRACE:
	•	gets a few gentle recipe ideas via Tasty
	•	passes them in as a hidden system message
	•	the model then weaves them into a soft, no-pressure reply

1.1 Food keyword detector

Add this near your other helpers in server/index.js:
function isFoodRelated(text) {
  if (!text) return false;
  const t = text.toLowerCase();

  return (
    t.includes('recipe') ||
    t.includes('cook something') ||
    t.includes('what should i cook') ||
    t.includes('what should i make') ||
    t.includes('dinner ideas') ||
    t.includes('lunch ideas') ||
    t.includes('snack ideas') ||
    t.includes('comfort food') ||
    t.includes('i want something warm') ||
    t.includes('i want something healthy') ||
    t.includes('i don\'t feel like eating') ||
    t.includes('no appetite') ||
    t.includes('haven\'t eaten') ||
    t.includes('food sounds hard') ||
    t.includes('i just want to eat') ||
    t.includes('craving') ||
    t.includes('hungry but tired')
  );
}

You can expand this list over time.

⸻

1.2 Tasty helper (direct function)

If you didn’t already make one, add this helper (using your Tasty/RapidAPI key in TASTY_API_KEY):
async function getRecipeSuggestions({ query }) {
  const apiKey = process.env.TASTY_API_KEY;
  if (!apiKey) {
    console.warn('TASTY_API_KEY missing');
    return [];
  }

  const url =
    'https://tasty.p.rapidapi.com/recipes/list?from=0&size=5' +
    `&q=${encodeURIComponent(query)}`;

  try {
    const res = await fetch(url, {
      method: 'GET',
      headers: {
        'x-rapidapi-key': apiKey,
        'x-rapidapi-host': 'tasty.p.rapidapi.com',
      },
    });

    if (!res.ok) {
      console.error('Tasty API error', res.status, await res.text());
      return [];
    }

    const data = await res.json();
    const items = data.results || [];

    return items.slice(0, 3).map((r) => ({
      name: r.name,
      description: r.description || '',
      url: r.canonical_id || '',
    }));
  } catch (err) {
    console.error('Tasty fetch error', err);
    return [];
  }
}
Attach FOOD_CONTEXT before calling OpenAI

Helper:
async function maybeAttachFoodContext({ messages }) {
  const lastUser = [...messages].reverse().find((m) => m.role === 'user');
  if (!lastUser) return { messages, foodSummary: null };

  if (!isFoodRelated(lastUser.content)) {
    return { messages, foodSummary: null };
  }

  // Decide search intent based on wording
  const lowered = lastUser.content.toLowerCase();
  let query = 'simple comforting meal';

  if (lowered.includes('healthy') || lowered.includes('light')) {
    query = 'simple healthy dinner';
  } else if (lowered.includes('soup')) {
    query = 'easy soup';
  } else if (lowered.includes('snack')) {
    query = 'quick snack';
  }

  const recipes = await getRecipeSuggestions({ query });
  if (!recipes.length) {
    return { messages, foodSummary: null };
  }

  const formatted = recipes
    .map((r, idx) => `${idx + 1}. ${r.name}${r.description ? ` — ${r.description}` : ''}`)
    .join('\n');

  const systemFood = {
    role: 'system',
    content:
      `FOOD_CONTEXT: The user is talking about food / appetite / cooking.\n` +
      `Here are a few simple recipe ideas from a recipe API, already filtered down:\n` +
      `${formatted}\n\n` +
      `When you respond:\n` +
      `- Present 1–3 of these as gentle ideas, not assignments.\n` +
      `- Emphasize there is *no pressure* to cook or choose anything.\n` +
      `- If the user sounds like they have low appetite or food stress, focus on validation first, recipes second.\n` +
      `- Never mention that these came from an API or refer to FOOD_CONTEXT by name.`,
  };

  return {
    messages: [systemFood, ...messages],
    foodSummary: formatted,
  };
}

Wire into /api/chat

In your /api/chat route, where you already do weather/dog/holiday, add food into the pipeline.

Conceptually:
app.post('/api/chat', async (req, res) => {
  try {
    const { userId, messages } = req.body || {};
    if (!userId || !messages) {
      return res.status(400).json({ error: 'userId and messages are required' });
    }

    const profile = await getProfileForUser(userId);

    const { messages: withWeather } = await maybeAttachWeatherContext({
      messages,
      profile,
    });

    const { messages: withDog } = await maybeAttachDogContext({
      messages: withWeather,
      profile,
    });

    const { messages: withHoliday } = await maybeAttachHolidayContext({
      messages: withDog,
      profile,
    });

    const { messages: withFood } = await maybeAttachFoodContext({
      messages: withHoliday,
    });

    const systemPrompt = `
You are TRACE, a gentle, non-judgmental companion.

GENERAL TONE:
- You are never pushy, never transactional.
- You offer invitations, not instructions.
- You care more about how the user feels than what they do.

FOOD_CONTEXT (if present in system messages):
- Use food suggestions as gentle possibilities, not "plans" or "shoulds".
- Prioritize emotional validation around appetite, stress, or shame.
- Avoid diet talk, weight loss framing, or moral language about food ("good"/"bad" foods).
- Prefer phrases like "comforting", "light", "nourishing", "easy to make".
- If the user mentions disordered eating or extreme restriction, stay supportive and encourage professional help gently if appropriate—never give prescriptive nutrition advice.

HYDRATION:
- Occasionally, when the user mentions headaches, fatigue, dehydration, crying a lot, or long emotional processing, you may gently suggest a sip of water as a grounding act.
- Never nag or repeat hydration reminders too often.
- Phrase it as an option, not a requirement.

DOG_CONTEXT / HOLIDAY_CONTEXT / WEATHER_CONTEXT:
- Use only when clearly relevant to what the user is talking about.
- Never mention the word "CONTEXT" or say that you used an API.
    `.trim();

    const openaiResponse = await openai.chat.completions.create({
      model: 'gpt-4.1-mini',
      messages: [
        { role: 'system', content: systemPrompt },
        ...withFood,
      ],
      temperature: 0.7,
    });

    const answer = openaiResponse.choices?.[0]?.message;
    if (!answer) {
      return res.status(500).json({ error: 'No response from model' });
    }

    res.json({ reply: answer });
  } catch (err) {
    console.error('/api/chat error', err);
    res.status(500).json({ error: 'Internal server error' });
  }
});
FOOD & APPETITE TONE RULES
	•	Treat food as emotional and relational, not just fuel.
	•	Validate feelings about appetite, cravings, or lack of appetite before offering any suggestions.
	•	Avoid diet culture language: no “cheat meals,” no assigning moral value to foods (“good/bad,” “clean/dirty”).
	•	If the user expresses guilt about eating, respond with compassion and de-shaming, not advice.
	•	When offering ideas, frame them as “if it helps” or “if it sounds nice,” not tasks to complete.
	•	If the user hints at or describes disordered eating (restriction, purging, bingeing, obsession with calories), do not advise on food amounts. Instead, focus on emotional support and, when appropriate, encourage them to reach out to a trusted person or professional.
	•	Remember: TRACE is not a nutritionist or doctor. It offers emotional support and gentle grounding, not medical or dietary prescriptions.